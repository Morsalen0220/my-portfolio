{"ast":null,"code":"import { initializeApp } from 'firebase/app';\nimport { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';\nimport { getFirestore, doc, addDoc, updateDoc, deleteDoc, collection, query, onSnapshot } from 'firebase/firestore';\n\n// --- GLOBAL VARIABLES (Assumed to be defined in your environment/wrapper) ---\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\nexport const IS_ADMIN_USER = !!initialAuthToken;\n\n// Helper function for exponential backoff (for authentication only)\nconst withRetry = (fn, retries = 3, delay = 1000) => async (...args) => {\n  for (let i = 0; i < retries; i++) {\n    try {\n      return await fn(...args);\n    } catch (error) {\n      if (i === retries - 1) throw error;\n      await new Promise(resolve => setTimeout(resolve, delay * 2 ** i));\n    }\n  }\n};\n\n// --- FIREBASE INITIALIZATION ---\nlet app, db, auth;\nif (Object.keys(firebaseConfig).length) {\n  app = initializeApp(firebaseConfig);\n  db = getFirestore(app);\n  auth = getAuth(app);\n} else {\n  console.error(\"Firebase configuration is missing.\");\n}\n\n// Function to handle initial sign-in\nexport const signInUser = async () => {\n  if (!auth) return;\n  try {\n    if (initialAuthToken) {\n      await withRetry(signInWithCustomToken, 3, 2000)(auth, initialAuthToken);\n    } else {\n      await withRetry(signInAnonymously, 3, 2000)(auth);\n    }\n  } catch (error) {\n    console.error(\"Firebase sign-in failed:\", error);\n  }\n};\n\n// Exporting necessary instances and listener\nexport { auth, db, onAuthStateChanged, onSnapshot, query };\n\n// --- FIRESTORE UTILITIES ---\nconst COLLECTION_PATH = `artifacts/${appId}/public/data/portfolio_items`;\nconst getCollectionRef = () => collection(db, COLLECTION_PATH);\nexport const getPortfolioQuery = () => query(getCollectionRef());\nexport const addItem = async item => {\n  if (!db) return;\n  const docRef = await addDoc(getCollectionRef(), item);\n  return docRef.id;\n};\nexport const updateItem = async (id, item) => {\n  if (!db) return;\n  const docRef = doc(db, COLLECTION_PATH, id);\n  await updateDoc(docRef, item);\n};\nexport const deleteItem = async id => {\n  if (!db) return;\n  const docRef = doc(db, COLLECTION_PATH, id);\n  await deleteDoc(docRef);\n};","map":{"version":3,"names":["initializeApp","getAuth","signInAnonymously","signInWithCustomToken","onAuthStateChanged","getFirestore","doc","addDoc","updateDoc","deleteDoc","collection","query","onSnapshot","appId","__app_id","firebaseConfig","__firebase_config","JSON","parse","initialAuthToken","__initial_auth_token","IS_ADMIN_USER","withRetry","fn","retries","delay","args","i","error","Promise","resolve","setTimeout","app","db","auth","Object","keys","length","console","signInUser","COLLECTION_PATH","getCollectionRef","getPortfolioQuery","addItem","item","docRef","id","updateItem","deleteItem"],"sources":["D:/Projects/my-portfolio/src/firebase/utils.js"],"sourcesContent":["import { initializeApp } from 'firebase/app';\r\nimport { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';\r\nimport { getFirestore, doc, addDoc, updateDoc, deleteDoc, collection, query, onSnapshot } from 'firebase/firestore';\r\n\r\n// --- GLOBAL VARIABLES (Assumed to be defined in your environment/wrapper) ---\r\nconst appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';\r\nconst firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};\r\nconst initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;\r\n\r\nexport const IS_ADMIN_USER = !!initialAuthToken;\r\n\r\n// Helper function for exponential backoff (for authentication only)\r\nconst withRetry = (fn, retries = 3, delay = 1000) => async (...args) => {\r\n    for (let i = 0; i < retries; i++) {\r\n        try {\r\n            return await fn(...args);\r\n        } catch (error) {\r\n            if (i === retries - 1) throw error;\r\n            await new Promise(resolve => setTimeout(resolve, delay * (2 ** i)));\r\n        }\r\n    }\r\n};\r\n\r\n// --- FIREBASE INITIALIZATION ---\r\nlet app, db, auth;\r\nif (Object.keys(firebaseConfig).length) {\r\n    app = initializeApp(firebaseConfig);\r\n    db = getFirestore(app);\r\n    auth = getAuth(app);\r\n} else {\r\n    console.error(\"Firebase configuration is missing.\");\r\n}\r\n\r\n// Function to handle initial sign-in\r\nexport const signInUser = async () => {\r\n    if (!auth) return;\r\n    try {\r\n        if (initialAuthToken) {\r\n            await withRetry(signInWithCustomToken, 3, 2000)(auth, initialAuthToken);\r\n        } else {\r\n            await withRetry(signInAnonymously, 3, 2000)(auth);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Firebase sign-in failed:\", error);\r\n    }\r\n};\r\n\r\n// Exporting necessary instances and listener\r\nexport { auth, db, onAuthStateChanged, onSnapshot, query };\r\n\r\n// --- FIRESTORE UTILITIES ---\r\nconst COLLECTION_PATH = `artifacts/${appId}/public/data/portfolio_items`;\r\n\r\nconst getCollectionRef = () => collection(db, COLLECTION_PATH);\r\n\r\nexport const getPortfolioQuery = () => query(getCollectionRef());\r\n\r\nexport const addItem = async (item) => {\r\n    if (!db) return;\r\n    const docRef = await addDoc(getCollectionRef(), item);\r\n    return docRef.id;\r\n};\r\n\r\nexport const updateItem = async (id, item) => {\r\n    if (!db) return;\r\n    const docRef = doc(db, COLLECTION_PATH, id);\r\n    await updateDoc(docRef, item);\r\n};\r\n\r\nexport const deleteItem = async (id) => {\r\n    if (!db) return;\r\n    const docRef = doc(db, COLLECTION_PATH, id);\r\n    await deleteDoc(docRef);\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}